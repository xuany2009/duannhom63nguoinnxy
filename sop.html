<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè H√†ng - Tam Ca B√°nh Ng·ªçt</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #f5f5f3;
            padding: 20px;
            min-height: 100vh;
        }

        /* Th√™m ph·∫ßn header gi·ªëng trang ch·ªß */
        #header {
            background: rgb(245, 245, 233);
            width: calc(100% - 40px);
            padding: 0 30px;
            margin: 20px auto 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        #menu {
            list-style: none;
            display: flex;
        }

        #menu .item {
            margin: 0 25px;
        }

        #menu .item a {
            color: #626a67;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            transition: color 0.3s;
        }

        #menu .item a:hover {
            color: #e91e63;
        }

        #actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        #actions .item {
            position: relative;
        }

        #actions .item a {
            color: #626a67;
            font-size: 24px;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        #actions .item a:hover {
            color: #e91e63;
            background: rgba(233, 30, 99, 0.1);
        }

        #cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ff4081, #e91e63);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .cart-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #626a67;
            margin-bottom: 30px;
            font-size: 36px;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .back-btn {
            background: #626a67;
            color: #fff;
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #4a4f4a;
            transform: translateY(-2px);
        }

        .cart-actions {
            display: flex;
            gap: 15px;
        }

        .cart-actions button, .cart-actions a {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        #clear-cart-btn {
            background: #f44336;
            color: white;
        }

        #clear-cart-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        #continue-shopping {
            background: #2196F3;
            color: white;
        }

        #continue-shopping:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .cart-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .cart-table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .cart-table th {
            color: white;
            padding: 20px 15px;
            text-align: center;
            font-weight: 600;
        }

        .cart-table td {
            padding: 20px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .product-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .product-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
            text-align: left;
        }

        .product-category {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
            text-align: left;
        }

        .price {
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-weight: bold;
        }

        .quantity-btn:hover {
            background: #f5f5f5;
            border-color: #667eea;
        }

        .quantity-input {
            width: 60px;
            height: 35px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
        }

        .item-total {
            font-weight: bold;
            color: #e91e63;
            font-size: 18px;
        }

        .remove-btn {
            background: #ff5252;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .remove-btn:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .cart-summary {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .summary-row.total {
            font-size: 24px;
            font-weight: bold;
            color: #e91e63;
            padding-top: 20px;
            border-top: 2px solid #eee;
            margin-top: 20px;
        }

        .checkout-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .checkout-btn:hover {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .empty-cart {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .empty-cart i {
            font-size: 80px;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-cart h2 {
            color: #666;
            margin-bottom: 20px;
        }

        .empty-cart p {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @media (max-width: 768px) {
            .cart-table thead {
                display: none;
            }
            
            .cart-table tr {
                display: block;
                margin-bottom: 20px;
                border: 1px solid #eee;
                border-radius: 10px;
                overflow: hidden;
            }
            
            .cart-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px;
                text-align: right;
                border-bottom: 1px solid #eee;
            }
            
            .cart-table td::before {
                content: attr(data-label);
                font-weight: bold;
                color: #333;
                text-align: left;
                margin-right: 20px;
            }
            
            .product-info {
                justify-content: space-between;
                width: 100%;
            }
            
            .cart-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .cart-actions {
                flex-direction: column;
            }
            
            .user-info {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
                justify-content: center;
            }
            
            #header {
                flex-direction: column;
                padding: 15px;
                gap: 15px;
            }
            
            #menu {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            
            #menu .item {
                margin: 0 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Th√™m ph·∫ßn header gi·ªëng trang ch·ªß -->
    <div id="header">
        <a href="index.html" class="logo">
            <img src="./·∫£nh/flower-seeklogo.png" alt="Logo Ti·ªám Hoa" width="120" height="80">
        </a>
        
        <div id="menu">
            <div class="item">
                <a href="index.html">Trang Ch·ªß</a>
            </div>
            <div class="item">
                <a href="index.html#products">S·∫£n ph·∫©m</a>
            </div>
            <div class="item">
                <a href="index.html#comment">Gi·ªõi thi·ªáu</a>
            </div>
            <div class="item">
                <a href="index.html#footer">Li√™n h·ªá</a>
            </div>
        </div>

        <div id="actions">
            <div class="item">
                <a href="login.html" title="ƒêƒÉng nh·∫≠p">
                    <i class="fas fa-user-circle"></i>
                </a>
            </div>
            <div class="item">
                <a href="sop.html" id="cart-btn" title="Gi·ªè h√†ng">
                    <i class="fas fa-shopping-cart"></i>
                </a>
                <span id="cart-badge">0</span>
            </div>
        </div>
    </div>

    <div class="cart-container">
        <h1><i class="fas fa-shopping-cart"></i> Gi·ªè H√†ng C·ªßa B·∫°n</h1>
        
        <div class="cart-header">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Quay V·ªÅ Trang Ch·ªß
            </a>
            
            <div class="cart-actions">
                <button id="clear-cart-btn">
                    <i class="fas fa-trash"></i> X√≥a Gi·ªè H√†ng
                </button>
                <a href="index.html#products" id="continue-shopping">
                    <i class="fas fa-shopping-bag"></i> Ti·∫øp T·ª•c Mua S·∫Øm
                </a>
            </div>
        </div>

        <div id="cart-content">
            <!-- Gi·ªè h√†ng s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông b·∫±ng JavaScript -->
            <div class="empty-cart" id="empty-cart-message">
                <i class="fas fa-shopping-cart"></i>
                <h2>Gi·ªè h√†ng tr·ªëng</h2>
                <p>B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng</p>
                <a href="index.html#products" id="continue-shopping">
                    <i class="fas fa-shopping-bag"></i> Mua S·∫Øm Ngay
                </a>
            </div>
        </div>
        
        <div class="cart-summary" id="cart-summary" style="display: none;">
            <div class="summary-row">
                <span>T·ªïng s·∫£n ph·∫©m:</span>
                <span id="total-items">0</span>
            </div>
            <div class="summary-row">
                <span>T·∫°m t√≠nh:</span>
                <span id="subtotal">0 VNƒê</span>
            </div>
            <div class="summary-row">
                <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                <span>Mi·ªÖn ph√≠</span>
            </div>
            <div class="summary-row total">
                <span>T·ªïng thanh to√°n:</span>
                <span id="grand-total">0 VNƒê</span>
            </div>
            
            <button class="checkout-btn" id="checkout-btn">
                <i class="fas fa-credit-card"></i> Thanh To√°n
            </button>
        </div>
    </div>




     <script src="about-us.js"></script>




    <script src="cart.js"></script>
   <script>
    // Ki·ªÉm tra ƒëƒÉng nh·∫≠p khi v√†o trang gi·ªè h√†ng
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ƒêang kh·ªüi t·∫°o trang gi·ªè h√†ng...');
        
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) {
            alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem gi·ªè h√†ng!');
            window.location.href = 'login.html';
            return;
        }
        
        // Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng
        try {
            const user = JSON.parse(currentUser);
            const userInfo = document.createElement('div');
            userInfo.className = 'user-info';
            userInfo.innerHTML = `
                <img src="${user.avatar || 'https://i.pravatar.cc/150?img=3'}" 
                     class="user-avatar"
                     onerror="this.src='https://i.pravatar.cc/150?img=3'">
                <span>${user.username}</span>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                </button>
            `;
            document.body.appendChild(userInfo);
        } catch (error) {
            console.error('L·ªói khi hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng:', error);
        }
        
        window.logout = function() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        };
        
        // ƒê·∫£m b·∫£o cartManager ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o
        setTimeout(() => {
            loadCart();
            
            // X·ª≠ l√Ω s·ª± ki·ªán
            document.getElementById('clear-cart-btn').addEventListener('click', clearCart);
            
            // Th√™m event listener cho n√∫t thanh to√°n
            setupCheckoutButton();
        }, 100);
    });
    
    function loadCart() {
        try {
            console.log('ƒêang t·∫£i gi·ªè h√†ng...');
            
            // Ki·ªÉm tra localStorage
            const cartData = localStorage.getItem('cart');
            console.log('Cart data t·ª´ localStorage:', cartData);
            
            // L·∫•y cartManager an to√†n
            let cartManager;
            if (typeof window.cartManager !== 'undefined' && window.cartManager && window.cartManager.getCart) {
                cartManager = window.cartManager;
                console.log('S·ª≠ d·ª•ng cartManager t·ª´ window');
            } else {
                console.log('T·∫°o cartManager m·ªõi...');
                cartManager = {
                    getCart: function() {
                        try {
                            const cart = localStorage.getItem('cart');
                            return cart ? JSON.parse(cart) : [];
                        } catch (error) {
                            console.error('L·ªói khi l·∫•y gi·ªè h√†ng:', error);
                            return [];
                        }
                    },
                    removeFromCart: function(productId) {
                        try {
                            const cart = this.getCart();
                            const newCart = cart.filter(item => item.id !== productId);
                            localStorage.setItem('cart', JSON.stringify(newCart));
                            return true;
                        } catch (error) {
                            console.error('L·ªói khi x√≥a s·∫£n ph·∫©m:', error);
                            return false;
                        }
                    },
                    updateQuantity: function(productId, quantity) {
                        try {
                            const cart = this.getCart();
                            const item = cart.find(item => item.id === productId);
                            if (item) {
                                const newQty = Math.max(1, Math.min(99, quantity));
                                item.quantity = newQty;
                                localStorage.setItem('cart', JSON.stringify(cart));
                                return true;
                            }
                            return false;
                        } catch (error) {
                            console.error('L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng:', error);
                            return false;
                        }
                    },
                    clearCart: function() {
                        localStorage.setItem('cart', JSON.stringify([]));
                        return true;
                    },
                    getTotalItems: function() {
                        const cart = this.getCart();
                        return cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
                    },
                    getTotalPrice: function() {
                        const cart = this.getCart();
                        return cart.reduce((sum, item) => {
                            const price = parseInt(item.price) || 0;
                            const quantity = parseInt(item.quantity) || 0;
                            return sum + (price * quantity);
                        }, 0);
                    }
                };
                window.cartManager = cartManager;
            }
            
            const cart = cartManager.getCart();
            console.log('S·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè:', cart.length);
            console.log('Chi ti·∫øt gi·ªè h√†ng:', cart);
            
            const cartContent = document.getElementById('cart-content');
            const cartSummary = document.getElementById('cart-summary');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            
            if (!cart || !Array.isArray(cart) || cart.length === 0) {
                console.log('Gi·ªè h√†ng tr·ªëng');
                if (emptyCartMessage) emptyCartMessage.style.display = 'block';
                if (cartSummary) {
                    // V·∫™N HI·ªÇN TH·ªä PH·∫¶N T·ªîNG K·∫æT NH∆ØNG V·ªöI GI√Å TR·ªä 0
                    cartSummary.style.display = 'block';
                    document.getElementById('total-items').textContent = '0';
                    document.getElementById('subtotal').textContent = '0 VNƒê';
                    document.getElementById('grand-total').textContent = '0 VNƒê';
                    
                    // TH√äM TH√îNG B√ÅO V√ÄO N√öT THANH TO√ÅN
                    const checkoutBtn = document.getElementById('checkout-btn');
                    if (checkoutBtn) {
                        checkoutBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng tr·ªëng';
                        checkoutBtn.style.background = 'linear-gradient(135deg, #9e9e9e, #757575)';
                        checkoutBtn.style.cursor = 'not-allowed';
                        checkoutBtn.disabled = true;
                        checkoutBtn.onclick = function() {
                            alert('Gi·ªè h√†ng tr·ªëng! Vui l√≤ng th√™m s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n.');
                        };
                    }
                }
                updateCartBadge();
                return;
            }
            
            if (emptyCartMessage) emptyCartMessage.style.display = 'none';
            if (cartSummary) cartSummary.style.display = 'block';
            
            // KH√îI PH·ª§C N√öT THANH TO√ÅN V·ªÄ TR·∫†NG TH√ÅI B√åNH TH∆Ø·ªúNG
            const checkoutBtn = document.getElementById('checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.innerHTML = '<i class="fas fa-credit-card"></i> Thanh To√°n';
                checkoutBtn.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
                checkoutBtn.style.cursor = 'pointer';
                checkoutBtn.disabled = false;
                checkoutBtn.onclick = checkout;
            }
            
            // T·∫°o b·∫£ng gi·ªè h√†ng
            let html = `
                <table class="cart-table">
                    <thead>
                        <tr>
                            <th>S·∫£n Ph·∫©m</th>
                            <th>Gi√°</th>
                            <th>S·ªë L∆∞·ª£ng</th>
                            <th>T·ªïng</th>
                            <th>Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let totalItems = 0;
            let subtotal = 0;
            
            cart.forEach(item => {
                const price = parseInt(item.price) || 0;
                const quantity = parseInt(item.quantity) || 1;
                const itemTotal = price * quantity;
                totalItems += quantity;
                subtotal += itemTotal;
                
                html += `
                    <tr data-id="${item.id}">
                        <td data-label="S·∫£n Ph·∫©m">
                            <div class="product-info">
                                <img src="${item.image || './·∫£nh/default-cake.jpg'}" 
                                     alt="${item.name}" 
                                     class="product-image"
                                     onerror="this.src='./·∫£nh/default-cake.jpg'">
                                <div>
                                    <div class="product-name">${item.name || 'S·∫£n ph·∫©m kh√¥ng t√™n'}</div>
                                    <div class="product-category">${item.category || 'Kh√¥ng ph√¢n lo·∫°i'}</div>
                                    <div class="product-size">K√≠ch th∆∞·ªõc: ${item.size || '1kg'}</div>
                                </div>
                            </div>
                        </td>
                        <td data-label="Gi√°" class="price">${formatPrice(price)} VNƒê</td>
                        <td data-label="S·ªë L∆∞·ª£ng">
                            <div class="quantity-control">
                                <button class="quantity-btn minus" onclick="updateQuantity('${item.id}', -1)">-</button>
                                <input type="number" class="quantity-input" value="${quantity}" 
                                       min="1" max="99" onchange="updateQuantityInput('${item.id}', this.value)">
                                <button class="quantity-btn plus" onclick="updateQuantity('${item.id}', 1)">+</button>
                            </div>
                        </td>
                        <td data-label="T·ªïng" class="item-total">${formatPrice(itemTotal)} VNƒê</td>
                        <td data-label="Thao T√°c">
                            <button class="remove-btn" onclick="removeItem('${item.id}')" title="X√≥a s·∫£n ph·∫©m">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            cartContent.innerHTML = html;
            
            // C·∫≠p nh·∫≠t t·ªïng
            document.getElementById('total-items').textContent = totalItems;
            document.getElementById('subtotal').textContent = formatPrice(subtotal) + ' VNƒê';
            document.getElementById('grand-total').textContent = formatPrice(subtotal) + ' VNƒê';
            
            // C·∫≠p nh·∫≠t badge gi·ªè h√†ng
            updateCartBadge();
            
        } catch (error) {
            console.error('L·ªói nghi√™m tr·ªçng khi t·∫£i gi·ªè h√†ng:', error);
            
            // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói chi ti·∫øt
            const cartContent = document.getElementById('cart-content');
            if (cartContent) {
                cartContent.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-exclamation-triangle" style="color: #f44336;"></i>
                        <h2>L·ªói t·∫£i gi·ªè h√†ng</h2>
                        <p>ƒê√£ x·∫£y ra l·ªói khi t·∫£i gi·ªè h√†ng. Vui l√≤ng th·ª≠ l·∫°i.</p>
                        <p style="color: #999; font-size: 14px;">L·ªói: ${error.message}</p>
                        <button onclick="location.reload()" class="back-btn">
                            <i class="fas fa-redo"></i> T·∫£i l·∫°i trang
                        </button>
                    </div>
                `;
            }
        }
    }
    
    function updateCartBadge() {
        try {
            const cartManager = window.cartManager || {
                getTotalItems: function() {
                    try {
                        const cart = JSON.parse(localStorage.getItem('cart')) || [];
                        return cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
                    } catch (error) {
                        console.error('L·ªói khi ƒë·∫øm s·∫£n ph·∫©m:', error);
                        return 0;
                    }
                }
            };
            
            const totalItems = cartManager.getTotalItems();
            const cartBadge = document.getElementById('cart-badge');
            
            if (cartBadge) {
                cartBadge.textContent = totalItems > 99 ? '99+' : totalItems;
                cartBadge.style.display = totalItems > 0 ? 'flex' : 'none';
            }
        } catch (error) {
            console.error('L·ªói khi c·∫≠p nh·∫≠t badge gi·ªè h√†ng:', error);
        }
    }
    
    function updateQuantity(productId, change) {
        try {
            const cartManager = window.cartManager || {
                getCart: function() {
                    return JSON.parse(localStorage.getItem('cart')) || [];
                },
                updateQuantity: function(productId, quantity) {
                    const cart = JSON.parse(localStorage.getItem('cart')) || [];
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        const newQty = Math.max(1, Math.min(99, quantity));
                        item.quantity = newQty;
                        localStorage.setItem('cart', JSON.stringify(cart));
                        return true;
                    }
                    return false;
                }
            };
            
            const cart = cartManager.getCart();
            const item = cart.find(item => item.id === productId);
            
            if (item) {
                const currentQuantity = parseInt(item.quantity) || 1;
                const newQuantity = Math.max(1, Math.min(99, currentQuantity + change));
                
                if (newQuantity !== currentQuantity) {
                    cartManager.updateQuantity(productId, newQuantity);
                    
                    // C·∫¨P NH·∫¨T GIAO DI·ªÜN NGAY L·∫¨P T·ª®C
                    updateCartDisplay();
                    
                    // Hi·ªÉn th·ªã th√¥ng b√°o
                    showNotification(`ƒê√£ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng ${item.name} th√†nh ${newQuantity}`);
                }
            }
        } catch (error) {
            console.error('L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng:', error);
            showNotification('L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng', 'error');
        }
    }
    
    function updateQuantityInput(productId, value) {
        try {
            const cartManager = window.cartManager || {
                getCart: function() {
                    return JSON.parse(localStorage.getItem('cart')) || [];
                },
                updateQuantity: function(productId, quantity) {
                    const cart = JSON.parse(localStorage.getItem('cart')) || [];
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        const newQty = Math.max(1, Math.min(99, quantity));
                        item.quantity = newQty;
                        localStorage.setItem('cart', JSON.stringify(cart));
                        return true;
                    }
                    return false;
                }
            };
            
            const cart = cartManager.getCart();
            const item = cart.find(item => item.id === productId);
            
            if (item) {
                const quantity = parseInt(value) || 1;
                const newQuantity = Math.max(1, Math.min(99, quantity));
                
                if (newQuantity !== item.quantity) {
                    cartManager.updateQuantity(productId, newQuantity);
                    
                    // C·∫¨P NH·∫¨T GIAO DI·ªÜN NGAY L·∫¨P T·ª®C
                    updateCartDisplay();
                    
                    showNotification(`ƒê√£ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng ${item.name} th√†nh ${newQuantity}`);
                }
            }
        } catch (error) {
            console.error('L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng:', error);
            showNotification('L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng', 'error');
        }
    }
    
    function removeItem(productId) {
        try {
            const cartManager = window.cartManager || {
                getCart: function() {
                    return JSON.parse(localStorage.getItem('cart')) || [];
                },
                removeFromCart: function(productId) {
                    const cart = JSON.parse(localStorage.getItem('cart')) || [];
                    const newCart = cart.filter(item => item.id !== productId);
                    localStorage.setItem('cart', JSON.stringify(newCart));
                    return true;
                }
            };
            
            const cart = cartManager.getCart();
            const item = cart.find(item => item.id === productId);
            
            if (item) {
                if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a "${item.name}" kh·ªèi gi·ªè h√†ng?`)) {
                    cartManager.removeFromCart(productId);
                    
                    // C·∫¨P NH·∫¨T GIAO DI·ªÜN NGAY L·∫¨P T·ª®C
                    updateCartDisplay();
                    
                    showNotification(`ƒê√£ x√≥a "${item.name}" kh·ªèi gi·ªè h√†ng`);
                }
            }
        } catch (error) {
            console.error('L·ªói khi x√≥a s·∫£n ph·∫©m:', error);
            showNotification('L·ªói khi x√≥a s·∫£n ph·∫©m', 'error');
        }
    }
    
    function clearCart() {
        try {
            const cartManager = window.cartManager || {
                getCart: function() {
                    return JSON.parse(localStorage.getItem('cart')) || [];
                },
                clearCart: function() {
                    localStorage.setItem('cart', JSON.stringify([]));
                    return true;
                }
            };
            
            const cart = cartManager.getCart();
            
            if (cart.length === 0) {
                alert('Gi·ªè h√†ng ƒë√£ tr·ªëng!');
                return;
            }
            
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô gi·ªè h√†ng?')) {
                cartManager.clearCart();
                
                // C·∫¨P NH·∫¨T GIAO DI·ªÜN NGAY L·∫¨P T·ª®C
                updateCartDisplay();
                
                showNotification('ƒê√£ x√≥a to√†n b·ªô gi·ªè h√†ng');
            }
        } catch (error) {
            console.error('L·ªói khi x√≥a gi·ªè h√†ng:', error);
            showNotification('L·ªói khi x√≥a gi·ªè h√†ng', 'error');
        }
    }
    
    function checkout() {
        try {
            const cartManager = window.cartManager || {
                getCart: function() {
                    return JSON.parse(localStorage.getItem('cart')) || [];
                },
                getTotalPrice: function() {
                    const cart = JSON.parse(localStorage.getItem('cart')) || [];
                    return cart.reduce((sum, item) => {
                        const price = parseInt(item.price) || 0;
                        const quantity = parseInt(item.quantity) || 0;
                        return sum + (price * quantity);
                    }, 0);
                },
                getTotalItems: function() {
                    const cart = JSON.parse(localStorage.getItem('cart')) || [];
                    return cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
                },
                clearCart: function() {
                    localStorage.setItem('cart', JSON.stringify([]));
                    return true;
                }
            };
            
            const cart = cartManager.getCart();
            
            if (cart.length === 0) {
                alert('Gi·ªè h√†ng tr·ªëng! Vui l√≤ng th√™m s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n.');
                return;
            }
            
            // L∆∞u th√¥ng tin gi·ªè h√†ng cho thanh to√°n
            const orderData = {
                cart: cart,
                total: cartManager.getTotalPrice(),
                items: cartManager.getTotalItems(),
                timestamp: new Date().toISOString(),
                orderId: 'ORD-' + Date.now()
            };
            
            // L∆∞u ƒë∆°n h√†ng v√†o l·ªãch s·ª≠
            let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
            orderHistory.push(orderData);
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            
            // L∆∞u ƒë∆°n h√†ng hi·ªán t·∫°i
            localStorage.setItem('currentOrder', JSON.stringify(orderData));
            
            // X√ìA GI·ªé H√ÄNG SAU KHI THANH TO√ÅN TH√ÄNH C√îNG
            if (confirm(`X√°c nh·∫≠n thanh to√°n?\nT·ªïng ti·ªÅn: ${formatPrice(orderData.total)} VNƒê`)) {
                // X√≥a gi·ªè h√†ng
                cartManager.clearCart();
                
                // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                alert(`‚úÖ Thanh to√°n th√†nh c√¥ng!\n\nüì¶ M√£ ƒë∆°n h√†ng: ${orderData.orderId}\nüí∞ T·ªïng ti·ªÅn: ${formatPrice(orderData.total)} VNƒê\nüéÇ S·∫£n ph·∫©m: ${orderData.items} c√°i\n\nC·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng!`);
                
                // C·∫¨P NH·∫¨T GIAO DI·ªÜN NGAY L·∫¨P T·ª®C (gi·ªè h√†ng s·∫Ω tr·ªëng)
                updateCartDisplay();
                
                // Hi·ªÉn th·ªã th√¥ng b√°o
                showNotification('Thanh to√°n ho√†n t·∫•t! ƒê∆°n h√†ng c·ªßa b·∫°n ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω.');
            }
        } catch (error) {
            console.error('L·ªói khi thanh to√°n:', error);
            alert('L·ªói khi thanh to√°n: ' + error.message);
        }
    }
    
    // Th√™m h√†m ƒë·ªÉ c·∫≠p nh·∫≠t giao di·ªán nhanh h∆°n
    function updateCartDisplay() {
        const cartManager = window.cartManager || {
            getCart: function() {
                return JSON.parse(localStorage.getItem('cart')) || [];
            },
            getTotalItems: function() {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                return cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 0), 0);
            },
            getTotalPrice: function() {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                return cart.reduce((sum, item) => {
                    const price = parseInt(item.price) || 0;
                    const quantity = parseInt(item.quantity) || 0;
                    return sum + (price * quantity);
                }, 0);
            }
        };
        
        const cart = cartManager.getCart();
        const cartContent = document.getElementById('cart-content');
        const cartSummary = document.getElementById('cart-summary');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        
        if (cart.length === 0) {
            // ·∫®n b·∫£ng gi·ªè h√†ng n·∫øu c√≥
            const cartTable = cartContent.querySelector('.cart-table');
            if (cartTable) {
                cartTable.style.display = 'none';
            }
            
            // Hi·ªÉn th·ªã th√¥ng b√°o gi·ªè h√†ng tr·ªëng
            if (emptyCartMessage) emptyCartMessage.style.display = 'block';
            
            // V·∫™N HI·ªÇN TH·ªä PH·∫¶N T·ªîNG K·∫æT
            if (cartSummary) {
                cartSummary.style.display = 'block';
                document.getElementById('total-items').textContent = '0';
                document.getElementById('subtotal').textContent = '0 VNƒê';
                document.getElementById('grand-total').textContent = '0 VNƒê';
                
                // N√∫t thanh to√°n ·ªü tr·∫°ng th√°i disabled
                const checkoutBtn = document.getElementById('checkout-btn');
                if (checkoutBtn) {
                    checkoutBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng tr·ªëng';
                    checkoutBtn.style.background = 'linear-gradient(135deg, #9e9e9e, #757575)';
                    checkoutBtn.style.cursor = 'not-allowed';
                    checkoutBtn.disabled = true;
                    checkoutBtn.onclick = function() {
                        alert('Gi·ªè h√†ng tr·ªëng! Vui l√≤ng th√™m s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n.');
                    };
                }
            }
        } else {
            // N·∫øu c√≥ s·∫£n ph·∫©m, load l·∫°i to√†n b·ªô
            loadCart();
        }
        
        // C·∫≠p nh·∫≠t badge
        updateCartBadge();
    }
    
    // Th√™m event listener cho n√∫t thanh to√°n khi gi·ªè h√†ng tr·ªëng
    function setupCheckoutButton() {
        const checkoutBtn = document.getElementById('checkout-btn');
        if (checkoutBtn) {
            checkoutBtn.addEventListener('click', function() {
                const cartManager = window.cartManager || {
                    getCart: function() {
                        return JSON.parse(localStorage.getItem('cart')) || [];
                    }
                };
                
                const cart = cartManager.getCart();
                if (cart.length === 0) {
                    alert('Gi·ªè h√†ng tr·ªëng! Vui l√≤ng th√™m s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n.');
                    return false;
                }
                
                // N·∫øu c√≥ s·∫£n ph·∫©m, th·ª±c hi·ªán thanh to√°n
                checkout();
                return true;
            });
        }
    }
    
    function formatPrice(price) {
        try {
            return parseInt(price || 0).toLocaleString('vi-VN');
        } catch (error) {
            console.error('L·ªói khi format gi√°:', error);
            return '0';
        }
    }
    
    function showNotification(message, type = 'success') {
        try {
            // Ki·ªÉm tra xem ƒë√£ c√≥ notification ch∆∞a
            let notification = document.getElementById('cart-notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'cart-notification';
                document.body.appendChild(notification);
            }
            
            const colors = {
                'success': 'linear-gradient(135deg, #4CAF50, #2E7D32)',
                'error': 'linear-gradient(135deg, #ff5252, #d32f2f)',
                'info': 'linear-gradient(135deg, #2196F3, #1976D2)',
                'warning': 'linear-gradient(135deg, #FF9800, #F57C00)'
            };
            
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${colors[type] || colors['success']};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 9999;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                font-family: 'Poppins', sans-serif;
            `;
            
            // Th√™m CSS animation
            if (!document.querySelector('#cart-notification-style')) {
                const style = document.createElement('style');
                style.id = 'cart-notification-style';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // T·ª± ƒë·ªông x√≥a sau 3 gi√¢y
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        } catch (error) {
            console.error('L·ªói khi hi·ªÉn th·ªã th√¥ng b√°o:', error);
        }
    }
    
    // Export functions to global scope
    window.formatPrice = formatPrice;
    window.updateQuantity = updateQuantity;
    window.updateQuantityInput = updateQuantityInput;
    window.removeItem = removeItem;
    window.loadCart = loadCart;
    window.updateCartDisplay = updateCartDisplay;
</script>




</body>
</html>